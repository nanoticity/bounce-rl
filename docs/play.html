<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bounce, but Trained</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
            display: flex;
        }
        
        .sidebar {
            width: 200px;
            background: white;
            height: calc(100vh - 40px);
            position: fixed;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
            margin: 20px;
            border-radius: 5rem;
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.12), 0 1.5px 4px 0 rgba(0,0,0,0.10);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .sidebar a:first-child {
            margin-top: 30px;
        }
        
        .sidebar:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar a {
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            border-radius: 5rem;
            transition: all 0.3s ease;
            font-weight: 500;
            background: linear-gradient(135deg, #007bff, #0056b3);
            text-align: center;
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.12), 0 1.5px 4px 0 rgba(0,0,0,0.10);
        }
        
        .sidebar a:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar a.active {
            background: linear-gradient(135deg, #0056b3, #003a79);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        
        .main-content {
            margin-left: 200px;
            padding: 20px;
            width: calc(100% - 200px);
            box-sizing: border-box;
        }
        .demo, .demo-header, .demo-content, .directions-box, .canvas-outer {
            border-radius: 5rem;
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.12), 0 1.5px 4px 0 rgba(0,0,0,0.10);
        }
        .demo {
            background-color: #fff;
            margin: 20px auto;
            max-width: 1000px;
            overflow: hidden;
        }
        .demo-header {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            background-image: linear-gradient(135deg, #007bff , #8fc5fe);
            color: #fff;
            padding: 15px 20px;
            font-size: 20px;
        }

        .demo-header:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }

        .demo-content {
            padding: 20px;
        }

        #canvas {
            margin: 0 auto;
            display: block;
            padding: 20px;
            size: 1600px, 1097px;
            border-radius: 2rem;
        }

        .directions-box {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            background: #fff;
            border-radius: 2rem;
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.12), 0 1.5px 4px 0 rgba(0,0,0,0.10);
            padding: 32px 28px;
            margin: 32px auto;
            max-width: 800px;
        }

        .directions-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        
        .canvas-outer {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: fit-content;
            margin: 0 auto;
        }

        .canvas-outer:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }

        .mac-buttons-container {
            padding: 16px 0px 12px 16px;
            background: white;
            border-radius: 2rem 2rem 0 0;
            width: 100%;
            box-sizing: border-box;
            margin: 0;
        }
        
        .mac-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
            height: 12px;
            /* Align left */
            justify-content: flex-start;
        }
        
        .mac-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
        }
        
        .mac-close {
            background: #ff5f57;
        }
        
        .mac-minimize {
            background: #febc2e;
        }
        
        .mac-maximize {
            background: #28c840;
        }

        .canvas-container {
            background: white;
            padding: 0 16px 16px 16px;
            border-radius: 0 0 2rem 2rem;
            width: 100%;
            box-sizing: border-box;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.26.3/full/pyodide.js"></script>
</head>
<body> 
    <div class="sidebar">
        <a href="index.html">Training Mode</a>
        <a href="trained.html">Trained Mode</a>
        <a href="play.html" class="active">Play Mode</a>
    </div>
    <div class="main-content">
        <div id="loading-screen" style="position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.95);z-index:9999;font-size:2rem;opacity:1;transition:opacity 0.7s cubic-bezier(.4,0,.2,1);">
            <div>
                <div style="text-align:center;margin-bottom:1rem;">
                    <span style="display:inline-block;width:2.5rem;height:2.5rem;border:4px solid #2196F3;border-top:4px solid #fff;border-radius:50%;animation:spin 1s linear infinite;"></span>
                </div>
                Loading game...
            </div>
        </div>
        <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        </style>
        <script type="text/javascript">
            // Wake Lock API to prevent screen sleep
            let wakeLock = null;
            async function requestWakeLock() {
                try {
                    if ('wakeLock' in navigator) {
                        wakeLock = await navigator.wakeLock.request('screen');
                    }
                } catch (err) {
                    console.warn('Wake Lock not supported or failed:', err);
                }
            }
            requestWakeLock();
            document.addEventListener('visibilitychange', () => {
                if (wakeLock !== null && document.visibilityState === 'visible') {
                    requestWakeLock();
                }
            });
            const curloc = document.location.href;
            const curdir = curloc.substring(0, curloc.lastIndexOf('/'));
      
            async function main(){
              let pyodide = await loadPyodide();
              await pyodide.loadPackage(["pygame-ce"], { checkIntegrity: false })
              await pyodide.loadPackage(["numpy"], { checkIntegrity: false })
              canvas = document.getElementById("canvas");
              pyodide.canvas.setCanvas2D(canvas);
              let href = window.location.href;
              var link = href.substring(0, href.lastIndexOf('/')) + "/play.tar";
              let zipResponse = await fetch(link);
              let zipBinary = await zipResponse.arrayBuffer();
              pyodide.unpackArchive(zipBinary, "tar", { extractDir: "/lib/python3.12/site-packages/play" });
              pyodide.runPythonAsync(`
    import sys
    sys.path.append('/lib/python3.12/site-packages/play/docs/playable-python/')
    import main
    main.main()
    `)
              // Fade out loading screen when done
              const loading = document.getElementById('loading-screen');
              loading.style.opacity = 0;
              setTimeout(() => { loading.style.display = 'none'; }, 700);
            }
            main();
          </script>
        <div class="demo-header">Bounce Reinforcement Learning</div>
        <div class="directions-box">
          <h1>What does it do?</h1>
          <p>
              This is the original game that is playable by you on arrow keys, or by pressing the left side of the screen and the right side. 
          </p>
        </div>
        <div class="canvas-outer">
            <div class="mac-buttons-container">
                <div class="mac-buttons">
                    <div class="mac-button mac-close"></div>
                    <div class="mac-button mac-minimize"></div>
                    <div class="mac-button mac-maximize"></div>
                </div>
            </div>
            <div class="canvas-container">
                <canvas id="canvas" style="width:fit-content; height:fit-content;"></canvas>
            </div>
        </div>
        <p>Made with <span style="color: #ff0000;">&#9829;</span> By Nano </p>
    </div>
</body>
</html>